function buynow(pid){
    
    var qty = document.getElementById("qty_input").value;

    var r = new XMLHttpRequest();

    r.onreadystatechange = function () {
        if (r.readyState == 4 && r.status == 200) {
            var t = r.responseText;

            //alert(t);

           var obj = JSON.parse(t);

        if (t == "address error, Please Update your User Profile !") {
            //alert("Please Update Your Profile.");
            window.location = "userprofile.php";
        } else {

            // Payment completed. It can be a successful failure.
            payhere.onCompleted = function onCompleted(orderId) {
            console.log("Payment completed.OrderID:" + orderId);
            //saveInvoice(orderId, amount, qty, id, email);

            //window.location = "addinvoice.php?id="+orderId;

            saveInvoice (orderId, pid,obj["email"], obj["amount"], qty);

        // Note: validate the payment and show success or failure page to the customer
    };

    // Payment window closed
    payhere.onDismissed = function onDismissed() {
        // Note: Prompt user to pay again or show an error page
        console.log("Payment dismissed");
    };

    // Error occurred
    payhere.onError = function onError(error) {
        // Note: show an error page
        console.log("Error:"  + error);
    };

    // Put the payment variables here
    var payment = {
        "sandbox": true,
        "merchant_id": "1224190 ",    // Replace your Merchant ID
        "return_url": "http://localhost/shopplyown/singleProductView.php?id=" + pid,     // Important
        "cancel_url": "http://localhost/shopplyown/singleProductView.php?id=" + pid,     // Important
        "notify_url": "http://sample.com/notify",
        "order_id": obj["order_id"],
        "items": obj["items"],
        "amount": obj["amount"],
        "currency": obj["currency"],
        "hash": obj["hash"], // *Replace with generated hash retrieved from backend
        "first_name": obj["first_name"],
        "last_name": obj["last_name"],
        "email": obj["email"],
        "phone": obj["phone"],
        "address": obj["address"],
        "city": obj["city"],
        "country": obj["country"],
        "delivery_address": obj["delivery_address"],
        "delivery_city": obj["delivery_city"],
        "delivery_country": obj["delivery_country"],
        "custom_1": "",
        "custom_2": ""
    };

    payhere.startPayment(payment);

    }

        }
    }

    r.open("GET","process.php?id=" + pid + "&qty=" + qty, true);
    r.send();
}